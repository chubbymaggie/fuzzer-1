from logger import * # logging output

class SensitiveDataExploit():
	"""
	implements the concrete sensitive data exploit
	strategy
	"""

	def _checkForSensitiveData(self, vector, response, sensitive):
			
		""" 
		check that response has been sanitized. 
		@vector - vector executed
		@response - the response given
		"""

		for item in sensitive:
			if item in response.text:
				logger.info("Sensitive data leaked - \n  Page: %s\n  Form: %s\n  Vector: %s\n  Status:Code: %s\n" % (url,form,vector,response.status_code) )

	def execute(self, pages, session, strategy):
		"""
		execute strategy - fuzz all inputs and make sure 
		they have been sanitized
		"""
		vectors = strategy._getVectors()

		for page in pages:
			forms = page.get("inputs").get("forms")
			url = page.get("url")
			
			for form in forms:
				for vector in vectors:
					response = strategy._executeVector(url, vector, form)

					if response != None:
						sensitive = open(strategy.options.sensitive, "r").read().splitlines()
						self._checkForSensitiveData(vector, response, sensitive)